<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastAPI Todo í´ë¼ì´ì–¸íŠ¸</title>
    <style>
        body { 
            font-family: sans-serif; 
            margin: 20px; 
            background-color: #f4f4f4;
        }
        h1, h2 { border-bottom: 2px solid #ccc; padding-bottom: 5px; }
        fieldset { 
            margin-bottom: 20px; 
            border: 1px solid #ccc; 
            border-radius: 5px;
            background-color: #fff;
        }
        legend { font-weight: bold; font-size: 1.2em; }
        input[type="text"], input[type="number"] { 
            margin-right: 10px; 
            padding: 5px;
            min-width: 200px;
        }
        button { padding: 5px 10px; cursor: pointer; }
        ul { list-style-type: none; padding-left: 0; }
        li { 
            background-color: #eee; 
            margin-bottom: 5px; 
            padding: 10px; 
            border-radius: 3px;
        }
        li.completed { 
            text-decoration: line-through; 
            background-color: #d8ffd8; 
        }
        pre {
            background-color: #222;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            min-height: 50px;
        }
    </style>
</head>
<body>

    <h1>Todo API í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸</h1>

    <fieldset>
        <legend>ğŸ“ ì „ì²´ í•  ì¼ ëª©ë¡</legend>
        <button id="btn-fetch-all">ëª¨ë“  í•  ì¼ ê°€ì ¸ì˜¤ê¸°</button>
        <ul id="todo-list">
            </ul>
    </fieldset>

    <fieldset>
        <legend>â• ìƒˆ í•  ì¼ ì¶”ê°€</legend>
        <form id="form-add">
            <input type="text" id="input-task" placeholder="í•  ì¼ ë‚´ìš©..." required>
            <button type="submit">ì¶”ê°€</button>
        </form>
    </fieldset>

    <fieldset>
        <legend>ğŸ†” IDë¡œ í•­ëª© ì‘ì—…í•˜ê¸°</legend>
        <input type="number" id="input-item-id" placeholder="ID (ì˜ˆ: 1)" min="1">
        <button id="btn-get-single">ê°œë³„ ì¡°íšŒ</button>
        <button id="btn-delete">ì‚­ì œ</button>
        
        <hr>
        
        <form id="form-update">
            <strong>ìœ„ IDì˜ í•­ëª© ìˆ˜ì •:</strong><br>
            <input type="text" id="input-update-task" placeholder="ìƒˆ í•  ì¼ ë‚´ìš©" required>
            <label>
                <input type="checkbox" id="input-update-completed"> ì™„ë£Œë¨
            </label>
            <button type="submit">ìˆ˜ì •</button>
        </form>
    </fieldset>

    <fieldset>
        <legend>ğŸ“¡ API ì‘ë‹µ ê²°ê³¼</legend>
        <pre id="results">ì—¬ê¸°ì— API ì‘ë‹µ JSONì´ í‘œì‹œë©ë‹ˆë‹¤.</pre>
    </fieldset>

<script>
    const BASE_URL = 'http://127.0.0.1:8000/api';
    const listEl = document.getElementById('todo-list');
    const resultsEl = document.getElementById('results');

    // --- í—¬í¼ í•¨ìˆ˜ ---
    function showResult(data) {
        resultsEl.textContent = JSON.stringify(data, null, 2);
    }
    
    function showError(error) {
        console.error('API Error:', error);
        resultsEl.textContent = `[ì˜¤ë¥˜ ë°œìƒ]\n${error.message}\n\nFastAPI ì„œë²„(uvicorn todo:app)ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€, CORS ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.`;
    }

    // --- API í˜¸ì¶œ í•¨ìˆ˜ ---

    // (GET) /api/list - ëª¨ë“  í•­ëª© ì¡°íšŒ
    async function fetchAllTodos() {
        try {
            const response = await fetch(`${BASE_URL}/list`);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            
            // ëª©ë¡ UI ì—…ë°ì´íŠ¸
            listEl.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ë¹„ìš°ê¸°
            data.todos.forEach(todo => {
                const li = document.createElement('li');
                li.textContent = `[ID: ${todo.id}] ${todo.task}`;
                if (todo.completed) {
                    li.className = 'completed';
                }
                listEl.appendChild(li);
            });
            showResult(data);
        } catch (error) {
            showError(error);
        }
    }

    // (POST) /api/add - í•­ëª© ì¶”ê°€
    async function addTodo(task) {
        try {
            const response = await fetch(`${BASE_URL}/add`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ task: task })
            });
            const data = await response.json();
            showResult(data);
            fetchAllTodos(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        } catch (error) {
            showError(error);
        }
    }

    // (GET) /api/{item_id} - ê°œë³„ í•­ëª© ì¡°íšŒ
    async function getSingleTodo(id) {
        if (!id) {
            alert('IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }
        try {
            const response = await fetch(`${BASE_URL}/${id}`);
            const data = await response.json();
            
            if (response.status === 404) {
                showResult(data); // "Not found" ë©”ì‹œì§€ í‘œì‹œ
            } else {
                showResult(data);
                // ìˆ˜ì • í¼ì— ë°ì´í„° ì±„ìš°ê¸°
                document.getElementById('input-update-task').value = data.todo.task;
                document.getElementById('input-update-completed').checked = data.todo.completed;
            }
        } catch (error) {
            showError(error);
        }
    }

    // (PUT) /api/{item_id} - í•­ëª© ìˆ˜ì •
    async function updateTodo(id, task, completed) {
        if (!id) {
            alert('ë¨¼ì € ìˆ˜ì •í•  IDë¥¼ ì…ë ¥í•˜ê³  "ê°œë³„ ì¡°íšŒ"ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
            return;
        }
        try {
            const response = await fetch(`${BASE_URL}/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ task: task, completed: completed })
            });
            const data = await response.json();
            showResult(data);
            fetchAllTodos(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        } catch (error) {
            showError(error);
        }
    }

    // (DELETE) /api/{item_id} - í•­ëª© ì‚­ì œ
    async function deleteTodo(id) {
        if (!id || !confirm(`ì •ë§ë¡œ ID ${id} í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            return;
        }
        try {
            const response = await fetch(`${BASE_URL}/${id}`, {
                method: 'DELETE'
            });
            
            if (response.status === 204) { // No Content
                showResult({ message: `ID ${id} ì‚­ì œ ì™„ë£Œ.` });
                fetchAllTodos(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } else {
                const data = await response.json(); // 404 ë“± ì˜¤ë¥˜ ì‘ë‹µ
                showResult(data);
            }
        } catch (error) {
            showError(error);
        }
    }

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ---
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª©ë¡ ìë™ ë¡œë“œ
    document.addEventListener('DOMContentLoaded', fetchAllTodos);

    // ì „ì²´ ëª©ë¡ ë²„íŠ¼
    document.getElementById('btn-fetch-all').addEventListener('click', fetchAllTodos);

    // ì¶”ê°€ í¼
    document.getElementById('form-add').addEventListener('submit', (e) => {
        e.preventDefault(); // í¼ ê¸°ë³¸ ì œì¶œ ë™ì‘ ë°©ì§€
        const taskInput = document.getElementById('input-task');
        addTodo(taskInput.value);
        taskInput.value = ''; // ì…ë ¥ì°½ ë¹„ìš°ê¸°
    });

    // ê°œë³„ ì¡°íšŒ ë²„íŠ¼
    document.getElementById('btn-get-single').addEventListener('click', () => {
        const id = document.getElementById('input-item-id').value;
        getSingleTodo(id);
    });
    
    // ì‚­ì œ ë²„íŠ¼
    document.getElementById('btn-delete').addEventListener('click', () => {
        const id = document.getElementById('input-item-id').value;
        deleteTodo(id);
    });

    // ìˆ˜ì • í¼
    document.getElementById('form-update').addEventListener('submit', (e) => {
        e.preventDefault();
        const id = document.getElementById('input-item-id').value;
        const task = document.getElementById('input-update-task').value;
        const completed = document.getElementById('input-update-completed').checked;
        updateTodo(id, task, completed);
    });

</script>
</body>
</html>